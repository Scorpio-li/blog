---
title: 微信开发相关
comment: true
date: 2023-04-23 17:28:23
tags:
description:
categories:
keywords:
---

## 微信平台

1. [微信公众平台](https://mp.weixin.qq.com/)

- 微信公众平台是微信公众账号申请入口和管理后台。商户可以在公众平台提交基本资料、业务资料、财务资料申请开通微信支付功能。

2. [微信开放平台](https://open.weixin.qq.com/)

- 微信开放平台是商户APP接入微信支付开放接口的申请入口，通过此平台可申请微信APP支付。

3. [微信商户平台](https://pay.weixin.qq.com/index.php/public)

- 微信商户平台是微信支付相关的商户功能集合，包括参数配置、支付数据查询与统计、在线退款、代金券或立减优惠运营等功能。

4. [微信开放社区](https://developers.weixin.qq.com/community/homepage)

## 微信登录

以下为几类型微信登录的功能说明：

类型|	授权域/接口|	用户侧使用流程|	接入流程
---|---|---|---
App |接入微信SDK，并调用snsapi_userinfo|（1）在App内选择使用微信登录<br>（2）拉起微信客户端，打开用户授权页，完成登录授权|（1）注册微信开放平台（open.weixin.qq.com）帐号，并完成开发者资质认证 <br>（2）申请【App移动应用】并审核通过后可以使用，查看[开发文档](https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&t=resource/res_list&verify=1&id=open1419317851&token=&lang=zh_CN)
网站应用|snsapi_login|（1）用户使用微信“扫一扫”，在PC端扫码（2）客户端打开授权页，完成登录授权|1）注册微信开放平台（open.weixin.qq.com）帐号，并完成开发者资质认证（2）申请【网站应用】并审核通过后可以使用，查看[开发文档](https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&t=resource/res_list&verify=1&id=open1419316505&token=&lang=zh_CN)
微信客户端内H5|使用公众号的登录能力： snsapi_base snsapi_userinfo|snsapi_base：静默授权 snsapi_userinfo： （1）用户在H5内点击登录，唤起授权弹窗 （2）用户侧完成登录授权|（1）注册微信公众号，选择“服务号”类型，并完成微信认证（2）在公众号管理后台设置回调域名（3）接入微信登录能力，查看[开发文档](https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html)
小程序|wx.login wx.getUserInfo|wx.login：静默授权，开发者可获取openid wx.getUserInfo： （1）用户在小程序内点击组件，唤起登录窗口（2）用户侧完成登录授权 | （1）注册小程序 （2）接入微信登录功能，查看[开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html)，查看【
小程序|wx.login wx.getUserInfo|wx.login：静默授权，开发者可获取openid wx.getUserInfo： （1）用户在小程序内点击组件，唤起登录窗口（2）用户侧完成登录授权 | （1）注册小程序 （2）接入微信登录功能，查看[开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html)，查看[登录流程设计指引]()

对于多平台的服务，若开发者希望能识别用户身份，例如：希望用户在小程序内也能查看到在App内购买的商品订单，则可以通过平台提供的[UnionID机制](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/union-id.html)来实现用户身份识别。

## 微信支付

我们web前端涉及的微信支付一般是微信小程序或微信公众号，那么先要在微信小程序或者微信公众号管理后台申请开通微信支付功能。在开通微信支付之前你先要在微信商户平台上注册一个微信商户，然后在微信商户平台里绑定相关的微信小程序和微信公众号，然后再回到微信小程序或微信公众号管理后台进行确认绑定，这一过程就叫所谓开通微信支付功能。

业务流程图:

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b960cf149084be38d5ddb37d3fd9e60~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

重点步骤说明：

- 步骤3 用户下单发起支付，商户可通过JSAPI下单创建支付订单。

- 步骤8 商户可在微信浏览器内通过JSAPI调起支付API调起微信支付，发起支付请求。

- 步骤15 用户支付成功后，商户可接收到微信支付支付结果通知支付结果通知API。

- 步骤20 商户在没有接收到微信支付结果通知的情况下需要主动调用查询订单API查询支付结果。

### 小程序支付

小程序支付是指在商户既有的小程序内通过对接微信支付API，实现用户在小程序内完成交易的场景。

```js
wx.requestPayment
(
	{
		"timeStamp": "1414561699",
		"nonceStr": "5K8264ILTKCH16CQ2502SI8ZNMTM67VS",
		"package": "prepay_id=wx201410272009395522657a690389285100",
		"signType": "RSA",
		"paySign": "oR9d8PuhnIc+YZ8cBHFCwfgpaK9gd7vaRvkYD7rthRAZ\/X+QBhcCYL21N7cHCTUxbQ+EAt6Uy+lwSN22f5YZvI45MLko8Pfso0jm46v5hqcVwrk6uddkGuT+Cdvu4WBqDzaDjnNa5UK3GfE1Wfl2gHxIIY5lLdUgWFts17D4WuolLLkiFZV+JSHMvH7eaLdT9N5GBovBwu5yYKUR7skR8Fu+LozcSqQixnlEZUfyE55feLOQTUYzLmR9pNtPbPsu6WVhbNHMS3Ss2+AehHvz+n64GDmXxbX++IOBvm2olHu3PsOUGRwhudhVf7UcGcunXt8cqNjKNqZLhLw4jq\/xDg==",
		"success":function(res){},
		"fail":function(res){},
		"complete":function(res){}
	}
)
```

请求示例 uniapp

```js
// #ifdef MP
uni.requestPayment({
    "timeStamp": res.data.timeStamp,
    "nonceStr": res.data.nonceStr,
    "package": res.data.packageValue,
    "signType": res.data.signType,
    "paySign": res.data.paySign,
    "success": function(res) {
        callbackQueryOrder(orderId).then(res => {
            if (res.status === 'OK') {
                _this.$store.dispatch('saveCurrPayOrder', {...currPayOrder, status: 'success'})
                _this.$util.Tips({
                    title: '支付成功',
                    icon: 'success'
                }, {
                    tab: 4,
                    url: toPages
                })
            }
        }).catch(err => console.log(err))
    },
    "fail": function(res) {
        _this.$store.dispatch('saveCurrPayOrder', {...currPayOrder, status: 'fail'})
        _this.$util.Tips({
            title: '取消支付'
        }, {
            tab: 4,
            url: toPages
        });
    },
    "complete": function(res) {
        uni.hideLoading();
        //关闭当前页面跳转至订单状态
        if (res.errMsg == 'requestPayment:cancel') return that.$util.Tips({
            title: '取消支付'
        }, {
            tab: 4,
            url: goPages
        });
    }
})
// #endif
```

### 公众号支付（JSAPI网页支付）

JSAPI网页支付，即日常所说的公众号支付，可在微信公众号、朋友圈、聊天会话中点击页面链接，或者用微信“扫一扫”扫描页面地址二维码在微信中打开商户HTML5页面，在页面内下单完成支付。

通过JSAPI下单接口获取到发起支付的必要参数prepay_id，然后使用微信支付提供的前端JS方法调起公众号支付。

发起一个微信支付请求：

```js
wx.chooseWXPay({
  timestamp: 0, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符
  nonceStr: '', // 支付签名随机串，不长于 32 位
  package: '', // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=\*\*\*）
  signType: '', // 微信支付V3的传入RSA,微信支付V2的传入格式与V2统一下单的签名格式保持一致
  paySign: '', // 支付签名
  success: function (res) {
    // 支付成功后的回调函数
  }
});
```

[微信支付开发文档](https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml)















